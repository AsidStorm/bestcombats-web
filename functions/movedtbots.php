<?

  $wps=array();
  $wps[]=array(1, 3, 3);$wps[]=array(1, 4, 3);$wps[]=array(2, 4, 2);$wps[]=array(3, 4, 2);$wps[]=array(3, 5, 3);
  $wps[]=array(2, 5, 0);$wps[]=array(2, 6, 3);$wps[]=array(2, 5, 1);$wps[]=array(3, 5, 2);$wps[]=array(3, 4, 1);
  $wps[]=array(4, 4, 2);$wps[]=array(5, 4, 2);$wps[]=array(6, 4, 2);$wps[]=array(6, 5, 3);$wps[]=array(7, 5, 2);
  $wps[]=array(8, 5, 2);$wps[]=array(8, 4, 1);$wps[]=array(8, 5, 3);$wps[]=array(7, 5, 0);$wps[]=array(6, 5, 0);
  $wps[]=array(6, 4, 1);$wps[]=array(5, 4, 0);$wps[]=array(5, 3, 1);$wps[]=array(6, 3, 2);$wps[]=array(7, 3, 2);
  $wps[]=array(7, 2, 1);$wps[]=array(7, 1, 1);$wps[]=array(8, 1, 2);$wps[]=array(9, 1, 2);$wps[]=array(9, 2, 3);
  $wps[]=array(9, 3, 3);$wps[]=array(9, 4, 3);$wps[]=array(10, 4, 2);$wps[]=array(10, 5, 3);$wps[]=array(9, 5, 0);
  $wps[]=array(9, 6, 3);$wps[]=array(9, 7, 3);$wps[]=array(8, 7, 0);$wps[]=array(8, 8, 3);$wps[]=array(7, 8, 0);
  $wps[]=array(7, 9, 3);$wps[]=array(6, 9, 0);$wps[]=array(5, 9, 0);$wps[]=array(4, 9, 0);$wps[]=array(4, 8, 1);
  $wps[]=array(3, 8, 0);$wps[]=array(3, 7, 1);$wps[]=array(2, 7, 0);$wps[]=array(1, 7, 0);$wps[]=array(1, 8, 3);
  $wps[]=array(1, 9, 3);$wps[]=array(1, 10, 3);$wps[]=array(1, 11, 3);$wps[]=array(2, 11, 2);$wps[]=array(2, 12, 3);
  $wps[]=array(2, 11, 1);$wps[]=array(3, 11, 2);$wps[]=array(2, 11, 0);$wps[]=array(1, 11, 0);$wps[]=array(1, 10, 1);
  $wps[]=array(2, 10, 2);$wps[]=array(3, 10, 2);$wps[]=array(4, 10, 2);$wps[]=array(4, 9, 1);$wps[]=array(5, 9, 2);
  $wps[]=array(6, 9, 2);$wps[]=array(6, 10, 3);$wps[]=array(6, 11, 3);$wps[]=array(6, 12, 3);$wps[]=array(5, 12, 0);
  $wps[]=array(4, 12, 0);$wps[]=array(4, 13, 3);$wps[]=array(3, 13, 0);$wps[]=array(2, 13, 0);$wps[]=array(3, 13, 2);
  $wps[]=array(3, 14, 3);$wps[]=array(4, 14, 2);$wps[]=array(4, 15, 3);$wps[]=array(5, 15, 2);$wps[]=array(5, 16, 3);
  $wps[]=array(5, 15, 1);$wps[]=array(5, 14, 1);$wps[]=array(6, 14, 2);$wps[]=array(6, 15, 3);$wps[]=array(6, 14, 1);
  $wps[]=array(7, 14, 2);$wps[]=array(8, 14, 2);$wps[]=array(8, 15, 3);$wps[]=array(8, 16, 3);$wps[]=array(9, 16, 2);
  $wps[]=array(9, 17, 3);$wps[]=array(8, 17, 0);$wps[]=array(8, 18, 3);$wps[]=array(7, 18, 0);$wps[]=array(7, 17, 1);
  $wps[]=array(7, 18, 3);$wps[]=array(6, 18, 0);$wps[]=array(7, 18, 2);$wps[]=array(8, 18, 2);$wps[]=array(9, 18, 2);
  $wps[]=array(9, 17, 1);$wps[]=array(10, 17, 2);$wps[]=array(10, 18, 3);$wps[]=array(10, 19, 3);$wps[]=array(10, 20, 3);
  $wps[]=array(10, 19, 1);$wps[]=array(10, 18, 1);$wps[]=array(11, 18, 2);$wps[]=array(11, 17, 1);$wps[]=array(12, 17, 2);
  $wps[]=array(12, 18, 3);$wps[]=array(13, 18, 2);$wps[]=array(13, 19, 3);$wps[]=array(13, 20, 3);$wps[]=array(13, 19, 1);
  $wps[]=array(13, 18, 1);$wps[]=array(13, 17, 1);$wps[]=array(13, 16, 1);$wps[]=array(13, 15, 1);$wps[]=array(12, 15, 0);
  $wps[]=array(12, 14, 1);$wps[]=array(12, 13, 1);$wps[]=array(13, 13, 2);$wps[]=array(14, 13, 2);$wps[]=array(13, 13, 0);
  $wps[]=array(12, 13, 0);$wps[]=array(11, 13, 0);$wps[]=array(11, 12, 1);$wps[]=array(11, 11, 1);$wps[]=array(11, 10, 1);
  $wps[]=array(11, 9, 1);$wps[]=array(12, 9, 2);$wps[]=array(13, 9, 2);$wps[]=array(14, 9, 2);$wps[]=array(14, 10, 3);
  $wps[]=array(14, 11, 3);$wps[]=array(14, 12, 3);$wps[]=array(13, 12, 0);$wps[]=array(14, 12, 2);$wps[]=array(15, 12, 2);
  $wps[]=array(16, 12, 2);$wps[]=array(16, 13, 3);$wps[]=array(15, 13, 0);$wps[]=array(16, 13, 2);$wps[]=array(16, 12, 1);
  $wps[]=array(16, 11, 1);$wps[]=array(16, 12, 3);$wps[]=array(15, 12, 0);$wps[]=array(14, 12, 0);$wps[]=array(14, 11, 1);
  $wps[]=array(14, 10, 1);$wps[]=array(14, 9, 1);$wps[]=array(14, 8, 1);$wps[]=array(15, 8, 2);$wps[]=array(15, 7, 1);
  $wps[]=array(14, 7, 0);$wps[]=array(14, 8, 3);$wps[]=array(14, 9, 3);$wps[]=array(13, 9, 0);$wps[]=array(12, 9, 0);
  $wps[]=array(11, 9, 0);$wps[]=array(11, 10, 3);$wps[]=array(11, 11, 3);$wps[]=array(10, 11, 0);$wps[]=array(9, 11, 0);
  $wps[]=array(9, 10, 1);$wps[]=array(9, 9, 1);$wps[]=array(10, 9, 2);$wps[]=array(10, 8, 1);$wps[]=array(10, 7, 1);
  $wps[]=array(11, 7, 2);$wps[]=array(12, 7, 2);$wps[]=array(12, 8, 3);$wps[]=array(12, 7, 1);$wps[]=array(11, 7, 0);
  $wps[]=array(10, 7, 0);$wps[]=array(9, 7, 0);$wps[]=array(9, 6, 1);$wps[]=array(10, 6, 2);$wps[]=array(10, 5, 1);
  $wps[]=array(10, 4, 1);$wps[]=array(10, 3, 1);$wps[]=array(9, 3, 0);$wps[]=array(9, 2, 1);$wps[]=array(10, 2, 2);
  $wps[]=array(10, 1, 1);$wps[]=array(11, 1, 2);$wps[]=array(11, 2, 3);$wps[]=array(11, 3, 3);$wps[]=array(12, 3, 2);
  $wps[]=array(13, 3, 2);$wps[]=array(13, 2, 1);$wps[]=array(14, 2, 2);$wps[]=array(15, 2, 2);$wps[]=array(15, 3, 3);
  $wps[]=array(15, 2, 1);$wps[]=array(16, 2, 2);$wps[]=array(15, 2, 0);$wps[]=array(14, 2, 0);$wps[]=array(13, 2, 0);
  $wps[]=array(13, 3, 3);$wps[]=array(12, 3, 0);$wps[]=array(11, 3, 0);$wps[]=array(11, 2, 1);$wps[]=array(11, 1, 1);
  $wps[]=array(10, 1, 0);$wps[]=array(9, 1, 0);$wps[]=array(8, 1, 0);$wps[]=array(7, 1, 0);$wps[]=array(6, 1, 0);
  $wps[]=array(5, 1, 0);$wps[]=array(4, 1, 0);$wps[]=array(3, 1, 0);$wps[]=array(3, 2, 3);$wps[]=array(3, 3, 3);
  $wps[]=array(3, 4, 3);$wps[]=array(2, 4, 0);$wps[]=array(1, 4, 0);$wps[]=array(1, 3, 1);

  function movedtbots($fn) {
    global $wps, $data;
    $r=mq("select * from fieldparties where (user=11137 or user=11138 or user=11139) and battle=0");
    while ($rec=mysql_fetch_assoc($r)) {
      $i=0;
      foreach ($wps as $k=>$v) {
        $i++;
        if ($v[0]==$rec["x"] && $v[1]==$rec["y"] && $v[2]==$rec["dir"]) {
          
          break;
        }
      }
      if (!$wps[$i]) $i=0;
      mq("update fieldparties set x='".$wps[$i][0]."', y='".$wps[$i][1]."', dir='".$wps[$i][2]."', lastmove='".time()."' where id='$rec[id]' and lastmove<".(time()-10));
    }
    $data["wander"]=time();
    $f1=fopen(CHATROOT."fielddata/$fn.dat", "wb+");
    flock($f1, LOCK_EX);
    fwrite($f1, serialize($data));
    flock($f1, LOCK_UN);
    fclose($f1);
  }
?>